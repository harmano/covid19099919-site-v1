<!doctype html>
<html lang="en">
<head>
  <link rel="icon" href="assets/images/canadian_flag.svg">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Canada Covid 19</title>
  <meta name="description" content="Canada Covid-19">
  <meta name="author" content="SitePoint">
  <link rel="stylesheet" href="assets/css/style.css">
  <link rel="stylesheet" href="">
  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
  <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
  <script src="https://kit.fontawesome.com/ae027a5b04.js" crossorigin="anonymous"></script>
  <script type="text/javascript" src="https://www.google.com/jsapi"></script>
  <style media="screen">
    .filterDiv{
        display: none; /* Hidden by default */
    }
    /* The "show" class is added to the filtered elements */
    .show {
        display: block;
    }

    .chart {
      float: left;
    }

    .button-area {
      padding: 40px 0 0 30px;
      float: left;
    }

    .app-button {
      display: block;
      margin-bottom: 3px;
    }

    .axis text {
      font-size: 0.8em;
    }

    .axis line {
      stroke: #000;
    }

    .axis path {
      display: none;
    }

    .line {
      stroke: orange;
      fill: none;
      stroke-width: 3px;
    }

    .overlay {
      fill: none;
      pointer-events: all;
    }

    .tooltip {
      position: fixed;
      padding: 10px;
      font: 12px sans-serif;
      background: #222;
      color: #fff;
      border: 0px;
      border-radius: 8px;
      pointer-events: none;
      opacity: 0.9;
      visibility: hidden;

    }
  </style>
</head>
<nav style="padding-top:25px; margin-top:0px;"class=" d-block d-sm-none	d-none d-sm-block d-md-none d-none d-md-block d-lg-none" >
  <a href="index.html"><img src="assets/images/Covid19-canada-logo.png" class="brand-logo-mobile" alt=""></a>

  <div style="margin-top:-22px;" id="menuToggle">
    <!--
    A fake / hidden checkbox is used as click reciever,
    so you can use the :checked selector on it.
    -->
    <input type="checkbox" />

    <!--
    Some spans to act as a hamburger.

    They are acting like a real hamburger,
    not that McDonalds stuff.
    -->
    <span class="nav-mobile-margin"></span>
    <span class="nav-mobile-margin"></span>
    <span class="nav-mobile-margin"></span>

    <!--
    Too bad the menu has to be inside of the button
    but hey, it's pure CSS magic.
    -->
    <ul id="menu">
      <a class="nav-link-mobile" href="index.html"><li>Home</li></a>
      <a class="nav-link-mobile" href="stats.html"><li>Stats</li></a>
      <a class="nav-link-mobile" href="vaccine.html"><li>Vaccine</li></a>
      <a class="nav-link-mobile" href="fundrasiers.html"><li>Fundrasiers</li></a>
      <a class="nav-link-mobile" href="about.html"><li>Initiatives</li></a>

      <a class="nav-link-mobile" href="about.html" ><li>About</li></a>
    </ul>
  </div>
</nav>
<div class="d-none d-xl-block 	d-none d-lg-block d-xl-none">
  <nav style="padding-bottom:0px; padding-bottom:0px; margin-top:0px; margin-bottom:0px; height:70px; "  class="navbar-width navbar-margin-mobile navbar navbar-expand-lg navbar-light bg-white">
    <a class="alert-padding-top  brand-logo-large navbar-brand" href="#">
      <a class="navbar-brand " href="#"><img src="assets/images/Covid19-canada-logo.png" class="brand-logo" alt=""></a>
    </a>
    <div class="container-2 collapse navbar-collapse" id="navbarTogglerDemo01">
      <a class="navbar-brand" href="#"></a>
      <ul class="navbar-nav mr-auto mt-2 mt-lg-0">
      </ul>
      <div class="form-inline my-2 my-lg-0">
        <ul class="navbar-nav mr-auto mt-2 mt-lg-0">
          <li class="nav-item">
            <a class="nav-link" style="color:black;" href="index.html">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" style="color:black;" href="stats.html">Stats</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" style="color:black;" href="vaccine.html">Vaccine</a>
          </li>
          <li class="nav-item">
            <a class="nav-link"  style="color:black;" href="fundraisers.html">Fundraisers</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" style="color:black;" href="intiatives.html">Initiatives</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" style="color:black;" href="about.html">About Us</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
</div>
<!-- <div style=" margin-bottom:0; margin-top:-20px;  border:none; background-color:#fff9e7;" class="alert alert-warning" role="alert">
  <div style=" " class="alert-margin p-text-alert ">
    <i style="padding-right: 15px; color:orange;" class="fas fa-exclamation"></i> Last Updated <b>3 Hours ago</b> - For more information visit canada.ca
  </div>
</div>
<div style=" margin-bottom:0;  border:none; background-color:;" class="alert alert-primary" role="alert">
  <div style="" class=" alert-margin p-text-alert">
    <i style="padding-right: 10px;" class="far fa-smile"></i> 100% of ad revenue will go towards local initiatives and maintaining the site
  </div>
</div> -->

<div style="padding:7px; margin:0px; border-radius:0px; border:none;" class="margin-top-alert alert alert-danger alert-dismissible fade show alert-text " role="alert">
  <strong  style="padding-left:10%; ">
    <i style="padding-right: 15px; color:orange;" class="fas fa-exclamation"></i> Last Updated <b>3 Hours ago</b>
  </strong> - For more information visit canada.ca
  <button  style="font-size:20px; padding:2.5px; margin:0px;" type="button" class="close" data-dismiss="alert" aria-label="Close">
    <span aria-hidden="true">&times;</span>
  </button>
</div>
<div style="padding:7px; margin:0px; border-radius:0px;" class="alert alert-primary alert-dismissible fade show alert-text " role="alert">
  <i  style="padding-left:10%; ">
    <i style="padding-right: 10px;" class="far fa-smile"></i> 100% of ad revenue will go towards local initiatives and maintaining the site
  </i>
  <button  style="font-size:20px; padding:2.5px; margin:0px;" type="button" class="close" data-dismiss="alert" aria-label="Close">
    <span aria-hidden="true">&times;</span>
  </button>
</div>


<script src="//d3js.org/d3.v3.min.js"></script>
<script>
  d3.csv('assets/data.csv', function(day_data) {
    var formatDate = d3.time.format("%Y-%m-%d");
    var bisectDate = d3.bisector(function(d) { return formatDate.parse(d['date']); }).left;

    // fix those integers
    day_data.forEach(function(d, i) {
      d.value = parseInt(d.value);
    });

    ///////////////////////
    // generate weekly data
    var week_data = create_time_unit_data(parse_for_week);

    function parse_for_week(date) {
      return formatDate.parse(date).getDay();
    }

    ///////////////////////
    // generate monthly data
    var month_data = create_time_unit_data(parse_for_month);

    function parse_for_month(date) {
      return formatDate.parse(date).getDate() - 1;
    }

    ///////////////////////
    // helper functions
    function create_time_unit_data(parse_date) {
      var new_data = JSON.parse(JSON.stringify(day_data));
      new_data.forEach(function(d, i) {
        var offset = parse_date(d.date);
        if(offset == 0 || i == 0 || i == day_data.length - 1) { // it's a new date_unit, or this is the first or last date in the array
          d['start'] = true;
        } else {
          d['start'] = false;

          // add this value to the start of the week
          var tar_idx = i - offset;
          if(tar_idx < 0) { tar_idx = 0; }
          new_data[tar_idx].value += d.value;

          // then nil out
          d.value = -1;
        }
      });

      fill_in_gaps(new_data);
      return new_data;
    }

    function fill_in_gaps(data_array) {
      // go back in and fill in the missing dates
      data_array.forEach(function(d, i) {
        if(d.start == false) {
          var prev_val, next_val, prev_dist, next_dist;
          for(var idx = i; idx>=0; idx--) {
            if(data_array[idx].start == true) {
              prev_val = data_array[idx].value;
              prev_dist = i - idx;
              break;
            }
          }

          for(var idx = i; idx < data_array.length; idx++) {
            if(data_array[idx].start == true) {
              next_val = data_array[idx].value;
              next_dist = idx - i;
              break;
            }
          }

          d.value = prev_val + ((next_val - prev_val) * (prev_dist/ (prev_dist + next_dist)));
        }
      });
    }

    ///////////////////////
    // Time unit selection buttons
    var all_data = [
      { 'name': 'daily', 'data': day_data},
      { 'name': 'weekly', 'data': week_data},
      { 'name': 'monthly', 'data': month_data}
    ];

    d3.select('.button-area').selectAll('.app-button')
      .data(all_data)
      .enter().append('button')
      .attr('class', 'app-button')
      .html(function(d) { return d.name; })
      .on('click', function(d) {
        curr_data = d.data;
        updateChart();
      });

    ///////////////////////
    // Chart Size Setup
    var margin = { top: 40, right: 50, bottom: 20, left: 20 };

    var width = 840 - margin.left - margin.right;
    var height = 500 - margin.top - margin.bottom;

    var chart = d3.select(".chart")
        .attr("width", 840)
        .attr("height", 500)
      .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    ///////////////////////
    // Title
    chart.append("text")
      .text("Time Series")
      .attr("text-anchor", "middle")
      .attr("class", "graph-title")
      .attr("y", -10)
      .attr("x", width / 2.0);

    chart.append("text")
      .attr("text-anchor", "middle")
      .attr("style", "font-size: 0.9em")
      .attr("y", height + 50)
      .attr("x", width / 2.0);

    ///////////////////////
    // Scales
    var x = d3.time.scale()
        .domain(d3.extent(day_data, function(d) { return formatDate.parse(d.date); }))
        .range([0, width]);

    var y;

    ///////////////////////
    // Axis
    var xAxis = d3.svg.axis()
        .scale(x)
        .orient("bottom");

    chart.append("g")
        .attr("class", "x axis")
        .attr("transform", "translate(0," + height + ")")
        .call(xAxis);

    ///////////////////////
    // Tooltips
    var overlay = chart.append("rect")
        .attr("class", "overlay")
        .attr("width", width)
        .attr("height", height)
        .on("mouseover", function() { chart.selectAll('.focus').style("display", null); })
        .on("mouseout", function() { chart.selectAll('.focus').style("display", "none"); })

    var tooltip = d3.select("body").append("div")
        .attr("class", "tooltip");

    var focus = chart.append("g")
        .attr("class", "focus")
        .style("display", "none");

    focus.append("circle")
        .attr("r", 4.5)

    focus.append("text")
        .attr("x", 9)
        .attr("dy", ".35em");

    ///////////////////////
    // DYNAMIC STUFF GOES HERE
    // any data things that need to update (yxis, lines, etc)
    function updateChart() {
      ///////////////////////
      // Y axis changes
      y = d3.scale.linear()
          .domain([0, d3.max(curr_data, function(d) { return d.value; })])
          .range([height, 0]);

      var yAxis = d3.svg.axis()
          .scale(y)
          .orient("right");

      // remove any old axis
      chart.selectAll(".y-axis").remove()

      chart.append("g")
          .attr("class", "y axis y-axis")
          .attr("transform", "translate(" + (width + 5) + ",0)")
          .call(yAxis);

      ///////////////////////
      // Line changes
      var lineGenerator = d3.svg.line()
          .x(function(d) { return x(formatDate.parse(d.date)) })
          .y(function(d) { return y(d.value) });

      var lines = chart.selectAll(".line")
          .data([curr_data])

      lines.enter().append("path")
          .attr("class", "line")
          .attr("d", lineGenerator);

      lines.transition()
          .duration(1000)
          .attr("d", lineGenerator);

      overlay.on("mousemove", mousemove);
    }

    function mousemove() {
      var x0 = x.invert(d3.mouse(this)[0]),
          i = bisectDate(curr_data, x0, 1),
          d0 = curr_data[i - 1],
          d1 = curr_data[i];

      // search for dates where "start" == true, in other words, only valid dates for the dataset
      // start of week, start of month
      var i0 = i - 1;
      while(d0.start == false && i0 > 0) {
        i0 -= 1;
        d0 = curr_data[i0];
      }
      var i1 = i;
      while(d1.start == false && i1 < curr_data.length - 1) {
        i1 += 1;
        d1 = curr_data[i1];
      }

      var dIdx = x0 - d0.date > d1.date - x0 ? i1 : i0;

      var tar_date = curr_data[dIdx]['date'];
      var tooltip_string = tar_date;

      var tar_value = curr_data[dIdx].value;
      focus.attr("transform", "translate(" + x(formatDate.parse(tar_date)) + ","+y(tar_value)+ ")");
      tooltip_string += "<br>" + tar_value;

      tooltip.html(tooltip_string)
        .style("visibility", "visible")
        .style("top", d3.mouse(this)[1] - (tooltip[0][0].clientHeight - 30) + "px")
        .style("left", d3.mouse(this)[0] - (tooltip[0][0].clientWidth / 2.0) + "px");
    }

    // default
    curr_data = day_data;
    updateChart();
  });
</script>
  <div class="row">
    <svg class="chart"></svg>
    <div class='button-area'>
    </div>
</div>
<footer>


</footer>

</html>
